---
- hosts: monitoringserver
  become: yes
  #become_user: root
  become_method: sudo

  tasks:
   - name: Download grafana
     unarchive:
       src: "https://dl.grafana.com/oss/release/grafana-8.1.5.linux-amd64.tar.gz"
       dest: /tmp/
       remote_src: yes 
        
   - name: unzip the grafana 
     unarchive:
       src: "tar -zxvf grafana-8.1.5.linux-amd64.tar.gz"
       dest: /tmp/
       remote_src: yes

  - name: create grafana user
    user:
      name: grafana
      shell: /bin/false
      createhome: false
      system: true

  - name: start the grafana-server service
    systemd:
      name: grafana-server
      state: started
      enabled: yes
      daemon_reload: yes
